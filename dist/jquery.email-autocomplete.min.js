/*
 *  email-autocomplete - 0.1.3
 *  jQuery plugin that displays in-place autocomplete suggestions for email input fields.
 *  
 *
 *  Made by Low Yong Zhen <yz@stargate.io> 
 */

"use strict";!function(s){var t="emailautocomplete",e={suggClass:"eac-sugg",domains:["gmail.com","docomo.ne.jp","yahoo.co.jp","yahoo.ne.jp","ezweb.ne.jp","icloud.com","i.softbank.jp","softbank.ne.jp","ymobile.ne.jp","hotmail.co.jp"],overwriteDomains:!0};function o(i,t){this.$field=s(i),this.options=s.extend(!0,{},e,t),this._defaults=e,this.options.domains&&Array.isArray(this.options.domains)?this.options.overwriteDomains?this._domains=this.options.domains:this._domains=s.merge(this.options.domains,e.domains):this._domains=e.domains,this.init()}o.prototype={init:function(){Array.prototype.indexOf||this.doIndexOf(),this.fieldLeftOffset=null;var i=s("<div class='eac-input-wrap' />").css({display:this.$field.css("display"),position:"static"===this.$field.css("position")?"relative":this.$field.css("position"),fontSize:this.$field.css("fontSize")});this.$field.wrap(i),this.$cval=s("<span class='eac-cval' />").css({visibility:"hidden",position:"absolute",display:"inline-block",fontFamily:this.$field.css("fontFamily"),fontWeight:this.$field.css("fontWeight"),letterSpacing:this.$field.css("letterSpacing")}).insertAfter(this.$field);var t=(this.$field.outerHeight(!0)-this.$field.height())/2;this.$suggOverlay=s("<span class='"+this.options.suggClass+"' />").css({display:"block","box-sizing":"content-box",lineHeight:this.$field.css("lineHeight"),paddingTop:t+"px",paddingBottom:t+"px",fontFamily:this.$field.css("fontFamily"),fontWeight:this.$field.css("fontWeight"),letterSpacing:this.$field.css("letterSpacing"),position:"absolute",top:0,left:0}).insertAfter(this.$field),this.$field.on("keyup.eac",s.proxy(this.displaySuggestion,this)),this.$field.on("blur.eac",s.proxy(this.autocomplete,this)),this.$field.on("keydown.eac",s.proxy(function(i){39!==i.which&&9!==i.which||this.autocomplete()},this)),this.$suggOverlay.on("mousedown.eac touchstart.eac",s.proxy(this.autocomplete,this))},suggest:function(t){var i=t.split("@");return 1<i.length&&(t=i.pop()).length?(this._domains.filter(function(i){return 0===i.indexOf(t)}).shift()||"").replace(t,""):""},autocomplete:function(){if(void 0===this.suggestion||this.suggestion.length<1)return!1;this.$field.val(this.val+this.suggestion),this.$suggOverlay.text(""),this.$cval.text("")},displaySuggestion:function(i){this.val=this.$field.val(),this.suggestion=this.suggest(this.val),this.suggestion.length?i.preventDefault():this.$suggOverlay.text(""),this.$suggOverlay.text(this.suggestion),this.$cval.text(this.val),null===this.fieldLeftOffset&&(this.fieldLeftOffset=(this.$field.outerWidth(!0)-this.$field.width())/2);var t=this.$cval.width();this.$field.outerWidth()>t&&this.$suggOverlay.css("left",this.fieldLeftOffset+t+"px")},doIndexOf:function(){Array.prototype.indexOf=function(i,t){if(null==this)throw new TypeError('"this" is null or not defined');var s=this.length>>>0;for(t=+t||0,Math.abs(t)===1/0&&(t=0),t<0&&(t+=s)<0&&(t=0);t<s;t++)if(this[t]===i)return t;return-1}}},s.fn[t]=function(i){return this.each(function(){s.data(this,"yz_"+t)||s.data(this,"yz_"+t,new o(this,i))})}}(jQuery,(window,document));